<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Laysns注册登录逻辑分析及任意用户登录--登录和漏洞篇 | Dj3ntG0d's Blog</title><meta name="description" content="# 0x01 前言​        分析了大半天注册逻辑好像没什么卵用..收获为 User模型类的save()方法就将数据插入数据库.看到了remove_xss这个函数和发现单引号没有经过过滤被注入到数据库中,后续是否有二次注入.(此处讲道理,这个insert是有注入的,但是每次插入数据都要求要有验证码很麻烦.先把这个有意思的任意用户登录漏洞搞定.) # 0x02 登录页面分析​        登"><meta name="author" content="Dj3ntG0d"><meta name="copyright" content="Dj3ntG0d"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Laysns注册登录逻辑分析及任意用户登录--登录和漏洞篇"><meta name="twitter:description" content="# 0x01 前言​        分析了大半天注册逻辑好像没什么卵用..收获为 User模型类的save()方法就将数据插入数据库.看到了remove_xss这个函数和发现单引号没有经过过滤被注入到数据库中,后续是否有二次注入.(此处讲道理,这个insert是有注入的,但是每次插入数据都要求要有验证码很麻烦.先把这个有意思的任意用户登录漏洞搞定.) # 0x02 登录页面分析​        登"><meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Laysns注册登录逻辑分析及任意用户登录--登录和漏洞篇"><meta property="og:url" content="https://dj3ntg0d.github.io/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/"><meta property="og:site_name" content="Dj3ntG0d's Blog"><meta property="og:description" content="# 0x01 前言​        分析了大半天注册逻辑好像没什么卵用..收获为 User模型类的save()方法就将数据插入数据库.看到了remove_xss这个函数和发现单引号没有经过过滤被注入到数据库中,后续是否有二次注入.(此处讲道理,这个insert是有注入的,但是每次插入数据都要求要有验证码很麻烦.先把这个有意思的任意用户登录漏洞搞定.) # 0x02 登录页面分析​        登"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-07-05T14:07:04.000Z"><meta property="article:modified_time" content="2020-07-09T13:31:44.762Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://dj3ntg0d.github.io/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/"><link rel="prev" title="Laysns反序列化之任意文件删除漏洞分析" href="https://dj3ntg0d.github.io/2020/07/09/Laysns%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><link rel="next" title="Laysns注册登录逻辑分析及任意用户登录--注册篇" href="https://dj3ntg0d.github.io/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95--%E6%B3%A8%E5%86%8C%E7%AF%87/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">6</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-前言"><span class="toc-number">1.</span> <span class="toc-text"># 0x01 前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-登录页面分析"><span class="toc-number">2.</span> <span class="toc-text"># 0x02 登录页面分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#密码校验逻辑"><span class="toc-number">2.1.</span> <span class="toc-text"># 密码校验逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#登录成功"><span class="toc-number">2.2.</span> <span class="toc-text"># 登录成功</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemKey-cook"><span class="toc-number">2.3.</span> <span class="toc-text"># systemKey($cook)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-加解密函数encrypt"><span class="toc-number">3.</span> <span class="toc-text"># 0x03 加解密函数encrypt</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#总结"><span class="toc-number">3.1.</span> <span class="toc-text"># 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-漏洞成因-任意用户登录"><span class="toc-number">4.</span> <span class="toc-text"># 0x04 漏洞成因 - 任意用户登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#校验逻辑"><span class="toc-number">4.1.</span> <span class="toc-text"># 校验逻辑</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x05-复现"><span class="toc-number">5.</span> <span class="toc-text"># 0x05 复现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#复现"><span class="toc-number">5.1.</span> <span class="toc-text"># 复现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x06-总结"><span class="toc-number">6.</span> <span class="toc-text"># 0x06 总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-用户登录逻辑缺陷"><span class="toc-number">6.1.</span> <span class="toc-text">1.用户登录逻辑缺陷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-密钥获取"><span class="toc-number">6.2.</span> <span class="toc-text">2.密钥获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修复想法"><span class="toc-number">6.3.</span> <span class="toc-text"># 修复想法</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Dj3ntG0d's Blog</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Laysns注册登录逻辑分析及任意用户登录--登录和漏洞篇</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-07-05 22:07:04"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-07-05</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-07-09 21:31:44"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-07-09</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="# 0x01 前言"></a># 0x01 前言</h3><p>​        分析了大半天注册逻辑好像没什么卵用..收获为 <strong>User模型类的save()方法就将数据插入数据库.</strong>看到了remove_xss这个函数和发现单引号没有经过过滤被注入到数据库中,后续是否有二次注入.(此处讲道理,这个insert是有注入的,但是每次插入数据都要求要有验证码很麻烦.先把这个有意思的任意用户登录漏洞搞定.)</p>
<h3 id="0x02-登录页面分析"><a href="#0x02-登录页面分析" class="headerlink" title="# 0x02 登录页面分析"></a># 0x02 登录页面分析</h3><p>​        登录页面以及立即登录都是index方法.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">session(<span class="string">'callbackurl'</span>, <span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_REFERER'</span>])?@$_SERVER[<span class="string">'HTTP_REFERER'</span>]:url(<span class="string">'index/index/index'</span>));</span><br><span class="line">    <span class="comment">//设定回调url</span></span><br><span class="line">      <span class="keyword">if</span>(session(<span class="string">'userid'</span>)!=<span class="string">''</span>)&#123;</span><br><span class="line">          <span class="keyword">$this</span>-&gt;error(<span class="string">'你已登录'</span>,url(<span class="string">'index/index/index'</span>));</span><br><span class="line">      &#125;<span class="comment">//判断当前session的userid的值,有的话表示已经登录,跳转到主页.</span></span><br><span class="line">     </span><br><span class="line">      $site_config = Cache::get(<span class="string">'site_config'</span>);</span><br><span class="line">      $yzmarr = explode(<span class="string">','</span>, $site_config[<span class="string">'site_yzm'</span>]);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (in_array(<span class="number">2</span>, $yzmarr)) &#123;</span><br><span class="line">          $loginyzm = <span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          $loginyzm = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">$this</span>-&gt;assign(<span class="string">'loginyzm'</span>, $loginyzm);</span><br><span class="line">      $member = <span class="keyword">new</span> UserModel();</span><br><span class="line">      <span class="keyword">if</span> (request()-&gt;isPost()) &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (in_array(<span class="number">2</span>, $yzmarr)) &#123;</span><br><span class="line">              <span class="keyword">if</span> (!captcha_check(input(<span class="string">'code'</span>))) &#123;</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">return</span> json(<span class="keyword">array</span>(<span class="string">'code'</span> =&gt; <span class="number">0</span>, <span class="string">'msg'</span> =&gt; <span class="string">'验证码错误'</span>));</span><br><span class="line"></span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">          $data = input(<span class="string">'post.'</span>);</span><br><span class="line">          $status[<span class="string">'status'</span>] = <span class="keyword">array</span>(<span class="string">'gt'</span>, <span class="number">0</span>);</span><br><span class="line">          $userstr = $data[<span class="string">'username'</span>];</span><br><span class="line">          <span class="comment">//用户名、邮箱、手机号均可登陆</span></span><br><span class="line">          <span class="keyword">if</span> (preg_match(<span class="string">"/^1[34578]\d&#123;9&#125;$/"</span>, $userstr)) &#123;</span><br><span class="line">              $map[<span class="string">'mobile'</span>] = $userstr;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              $map[<span class="string">'username|usermail'</span>] = $userstr;</span><br><span class="line">          &#125;</span><br><span class="line">          $user = $member-&gt;where($status)-&gt;where($map)-&gt;find();</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> ($user) &#123;</span><br><span class="line"></span><br><span class="line">              $user = updategrade($user);</span><br><span class="line">              <span class="keyword">if</span> ($user[<span class="string">'password'</span>] == md5($data[<span class="string">'pass'</span>] . $user[<span class="string">'salt'</span>])) &#123;</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">if</span> ($user[<span class="string">'userhead'</span>] == <span class="string">''</span>) &#123;</span><br><span class="line">                      $user[<span class="string">'userhead'</span>] = <span class="string">'/public/images/default.png'</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  session(<span class="string">'userstatus'</span>, $user[<span class="string">'status'</span>]);</span><br><span class="line">                  session(<span class="string">'grades'</span>, $user[<span class="string">'grades'</span>]);</span><br><span class="line">                  session(<span class="string">'userhead'</span>, $user[<span class="string">'userhead'</span>]);</span><br><span class="line">                  session(<span class="string">'username'</span>, $user[<span class="string">'username'</span>]);</span><br><span class="line">                  session(<span class="string">'userid'</span>, $user[<span class="string">'id'</span>]);</span><br><span class="line">                  session(<span class="string">'point'</span>, $user[<span class="string">'point'</span>]);</span><br><span class="line">                  session(<span class="string">'developer'</span>, $user[<span class="string">'developer'</span>]);</span><br><span class="line">                  $cook = <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; $user[<span class="string">'id'</span>], <span class="string">'status'</span> =&gt; $user[<span class="string">'status'</span>], <span class="string">'point'</span> =&gt; $user[<span class="string">'point'</span>], <span class="string">'username'</span> =&gt; $user[<span class="string">'username'</span>], <span class="string">'userhead'</span> =&gt; $user[<span class="string">'userhead'</span>], <span class="string">'grades'</span> =&gt; $user[<span class="string">'grades'</span>]);</span><br><span class="line"></span><br><span class="line">                  <span class="comment">//获取消息</span></span><br><span class="line">                 </span><br><span class="line">                     <span class="comment">// $result = action('user/message/getUnreadMsg');</span></span><br><span class="line"></span><br><span class="line">                  systemSetKey($cook);</span><br><span class="line"></span><br><span class="line">                  $member-&gt;update(</span><br><span class="line">                      [</span><br><span class="line">                          <span class="string">'last_login_time'</span> =&gt; time(),</span><br><span class="line">                          <span class="string">'last_login_ip'</span> =&gt; <span class="keyword">$this</span>-&gt;request-&gt;ip(),</span><br><span class="line">                          <span class="string">'id'</span> =&gt; $user[<span class="string">'id'</span>],</span><br><span class="line">                      ]</span><br><span class="line">                  );</span><br><span class="line">                  point_note($site_config[<span class="string">'jifen_login'</span>], session(<span class="string">'userid'</span>), <span class="string">'login'</span>);</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">return</span> json(<span class="keyword">array</span>(<span class="string">'code'</span> =&gt; <span class="number">200</span>, <span class="string">'msg'</span> =&gt; <span class="string">'登录成功'</span>));</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="keyword">return</span> json(<span class="keyword">array</span>(<span class="string">'code'</span> =&gt; <span class="number">0</span>, <span class="string">'msg'</span> =&gt; <span class="string">'密码错误'</span>));</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> json(<span class="keyword">array</span>(<span class="string">'code'</span> =&gt; <span class="number">0</span>, <span class="string">'msg'</span> =&gt; <span class="string">'账号错误或已禁用'</span>));</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> view();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200706193922664.png" alt="image-20200706193922664"></p>
<p>数据包.第一次访问时,SESSION长这样.<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200706194012582.png" alt="image-20200706194012582"></p>
<p>因为前面配置了前缀,所有session会放在前缀后面.<strong>session助手函数也是去获取这个数组里面的值 $_SESSION[‘KakDR’] [sessionKEY]</strong></p>
<p>根据上面代码,首先设置好回调URL,接着判断SESSION中是否有userid这个字段的SESSION值,判断是否登录,登录了的话自动跳到主页,没有登录继续.</p>
<p>获取站点配置数组到$site_config,$yzmarr=[1,4],这个地方是判断是否开启登录验证码,这里loginyzm为1的时候才会开启,看到前端页面中有个if判断,如果loginyzm=1,才会输出下面那一端跟验证码相关的前端代码.</p>
<p>再次初始化一个User模型.利用input获取post数据.接着判断用户名是手机号,还是 用户名or邮箱 这2种情况,存到$map数组中.</p>
<p>接着<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200706200809363.png" alt="image-20200706200809363"></p>
<p>通过用户名去搜索到匹配的数据库条目,如果搜索有结果,进入下一步.</p>
<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200706201554944.png" alt="image-20200706201554944"></p>
<p><strong>updategrade()</strong> 作用为: 将数据库中 当前用户的行传入,<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707110504243.png" alt="image-20200707110504243"></p>
<p>是一个模型对象,保存了当前行的各种数据于$data中.用$data中的point值,<strong>去判断是普通用户还是其他用户,这里是普通用户(数据库中只有普通用户这一行.</strong>),然后把这行的id获取 = 1;</p>
<p>接着将当前的<strong>用户等级标识更新到user数据库中的grades字段,这里为1,然后将字段同步给模型对象并返回</strong>.</p>
<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707112028977.png" alt="image-20200707112028977"></p>
<p>同时,前面对对象是直接用数组方式来访问$data的参数值的,<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707112100141.png" alt="image-20200707112100141"></p>
<p>其实是做了\ArrayAccess接口的实现,<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707112123333.png" alt="image-20200707112123333"></p>
<p>会自动通过offsetGet去获取$data对应的参数值.<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707112152657.png" alt="image-20200707112152657"></p>
<p><strong>所以能够拿到对象里面$data数组对应的参数值.</strong></p>
<p>继续.85行是对用户密码进行验证,如果验证成功则返回登录成功,并且对session进行各种字段的设置.</p>
<h4 id="密码校验逻辑"><a href="#密码校验逻辑" class="headerlink" title="# 密码校验逻辑"></a># 密码校验逻辑</h4><p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707112415385.png" alt="image-20200707112415385"></p>
<p>​        <strong>很简单,就是通过模型对象,找到数据库中的password密码字段,与 当前密码拼接数据库中的盐值一起做MD5,相同则判断为登录成功.</strong></p>
<h4 id="登录成功"><a href="#登录成功" class="headerlink" title="# 登录成功"></a># 登录成功</h4><p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707113202811.png" alt="image-20200707113202811"></p>
<p>​        登录成功后对当前session进行设置登录信息,<strong>将信息存储为$cook数组.</strong></p>
<p>所以这个<strong>$cook 数组,保存了各种登录的用户信息,传入到systemKey方法.</strong></p>
<h4 id="systemKey-cook"><a href="#systemKey-cook" class="headerlink" title="# systemKey($cook)"></a># systemKey($cook)</h4><p>​        进来对cookie进行加密后设置.</p>
<p><strong>cookie(key,value)</strong>这个助手函数是 将 <strong>value setcookie到 cookie前缀+key中</strong></p>
<p>如下图就是 <strong>Cookie : KakDRsys_key=encrypt(serialize($user))</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$cook = <span class="keyword">array</span>(<span class="string">'id'</span> =&gt; $user[<span class="string">'id'</span>], <span class="string">'status'</span> =&gt; $user[<span class="string">'status'</span>], <span class="string">'point'</span> =&gt; $user[<span class="string">'point'</span>], <span class="string">'username'</span> =&gt; $user[<span class="string">'username'</span>], <span class="string">'userhead'</span> =&gt; $user[<span class="string">'userhead'</span>], <span class="string">'grades'</span> =&gt; $user[<span class="string">'grades'</span>]);</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707113752666.png" alt="image-20200707113752666"></p>
<p>先对$user数组<strong>进行序列化.</strong> 然后加密.跟进encrypt函数.</p>
<h3 id="0x03-加解密函数encrypt"><a href="#0x03-加解密函数encrypt" class="headerlink" title="# 0x03 加解密函数encrypt"></a># 0x03 加解密函数encrypt</h3><p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707114112783.png" alt="image-20200707114112783"></p>
<p>没有传入加密的密钥,<strong>默认使用管理员ID=1的盐值 ,进行md5后作为密钥.</strong></p>
<p><strong><em>记录下关键参数 ,密钥 = MD5 (id=1的管理员的salt)</em></strong></p>
<p>硬编码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ikey = <span class="string">"-x6g6ZWm2G9g_vr0Bo.pOq3kRIxsZ6rm"</span>;</span><br></pre></td></tr></table></figure>

<p>下面跟进加密算法.算法逻辑已经写在代码中.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span><span class="params">($txt, $key = <span class="string">''</span>)</span>//<span class="title">cookie</span>等的加密算法.</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($txt)) &#123;</span><br><span class="line">        <span class="keyword">return</span> $txt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($key)) &#123;</span><br><span class="line">        $salt = Db::name(<span class="string">'admin_user'</span>)-&gt;where(<span class="string">'id'</span>, <span class="number">1</span>)-&gt;value(<span class="string">'salt'</span>);</span><br><span class="line">        $key = md5($salt);</span><br><span class="line">    &#125;</span><br><span class="line">    $chars = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_."</span>;</span><br><span class="line">    $ikey = <span class="string">"-x6g6ZWm2G9g_vr0Bo.pOq3kRIxsZ6rm"</span>;</span><br><span class="line">    $nh1 = rand(<span class="number">0</span>, <span class="number">64</span>);<span class="comment">//</span></span><br><span class="line">    $nh2 = rand(<span class="number">0</span>, <span class="number">64</span>);<span class="comment">//</span></span><br><span class="line">    $nh3 = rand(<span class="number">0</span>, <span class="number">64</span>);<span class="comment">//</span></span><br><span class="line">    $ch1 = $chars&#123;$nh1&#125;; <span class="comment">//获取一个随机字符</span></span><br><span class="line">    $ch2 = $chars&#123;$nh2&#125;; <span class="comment">//获取一个随机字符</span></span><br><span class="line">    $ch3 = $chars&#123;$nh3&#125;; <span class="comment">//获取一个随机字符</span></span><br><span class="line">    $nhnum = $nh1 + $nh2 + $nh3; <span class="comment">// 随机整数之和</span></span><br><span class="line">    $knum = <span class="number">0</span>; <span class="comment">//keynum</span></span><br><span class="line">    $i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">isset</span>($key&#123;$i&#125;)) &#123;</span><br><span class="line">        $knum += ord($key&#123;$i++&#125;);</span><br><span class="line">    &#125;<span class="comment">//knum的值是 对密钥的每一位字符转换成ascii整数,然后相加</span></span><br><span class="line"></span><br><span class="line">    $mdKey = substr(md5(md5(md5($key . $ch1) . $ch2 . $ikey) . $ch3), $nhnum % <span class="number">8</span>, $knum % <span class="number">8</span> + <span class="number">16</span>);</span><br><span class="line">    <span class="comment">// $key 和 随机字符1 连接做md5,再拼接随机字符2,$ikey 做md5, 再拼接随机字符3 做md5,然后截取 (0-7) 任意位置开始的 长度为 16-23的字符串.</span></span><br><span class="line">    $txt = base64_encode(time() . <span class="string">'_'</span> . $txt);<span class="comment">//将明文前面连接上时间然后进行base64编码</span></span><br><span class="line">    $txt = str_replace(<span class="keyword">array</span>(<span class="string">'+'</span>, <span class="string">'/'</span>, <span class="string">'='</span>), <span class="keyword">array</span>(<span class="string">'-'</span>, <span class="string">'_'</span>, <span class="string">'.'</span>), $txt); <span class="comment">//然后对+ / = 换成 - _ .</span></span><br><span class="line">    $tmp = <span class="string">''</span>;</span><br><span class="line">    $j = <span class="number">0</span>;</span><br><span class="line">    $k = <span class="number">0</span>;</span><br><span class="line">    $tlen = strlen($txt);  <span class="comment">//得到明文base64之后的长度</span></span><br><span class="line">    $klen = strlen($mdKey); <span class="comment">// 得到mdkey长度</span></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $tlen; $i++) &#123; <span class="comment">//根据 遍历$txt 拼接新的 $tmp</span></span><br><span class="line">        $k = $k == $klen ? <span class="number">0</span> : $k; <span class="comment">//$k=0  k表示mdKey中的指针,这里表示指针循环.</span></span><br><span class="line">        $j = ($nhnum + strpos($chars, $txt&#123;$i&#125;) + ord($mdKey&#123;$k++&#125;)) % <span class="number">64</span>;</span><br><span class="line">        <span class="comment">//(随机数字之和 + 当前txt指针的字符位于字符集中的位置数字 + 当前mdKey指针位置字符的ascii码值) % 64</span></span><br><span class="line">        $tmp .= $chars&#123;$j&#125;;<span class="comment">//再讲上面的获得的指针找到字符集中指定位置的值,拼接给$tmp</span></span><br><span class="line">    &#125;</span><br><span class="line">    $tmplen = strlen($tmp);</span><br><span class="line">    $tmp = substr_replace($tmp, $ch3, $nh2 % ++$tmplen, <span class="number">0</span>); <span class="comment">//在tmp的nh2的位置插ch3  密文增长1位</span></span><br><span class="line">    $tmp = substr_replace($tmp, $ch2, $nh1 % ++$tmplen, <span class="number">0</span>);  <span class="comment">//继续在tmp的nh1的位置插nh2  密文增长1位</span></span><br><span class="line">    $tmp = substr_replace($tmp, $ch1, $knum % ++$tmplen, <span class="number">0</span>); <span class="comment">// 再在knum(几千) % 密文长度(大概200左右)的位置插ch1.    密文增长1位</span></span><br><span class="line">      <span class="comment">//91-93这3行,是为解密函数埋下随机数的算式,利用knum就可以链式解出ch1,ch2,ch3这3个随机字符,然后从而获得nh1,nh2,nh3 这3个随机数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到.关键点在于几个参数.</p>
<p>1.密钥 $key 来自 admin_user表中的salt再md5生成的.</p>
<p>2.$knum, 由$key的每一位的ascii码相加而成的一个整数.</p>
<p>下面附上解密函数分析过程注释:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($txt)) &#123;</span><br><span class="line">    <span class="keyword">return</span> $txt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($key)) &#123;</span><br><span class="line">    $salt = Db::name(<span class="string">'admin_user'</span>)-&gt;where(<span class="string">'id'</span>, <span class="number">1</span>)-&gt;value(<span class="string">'salt'</span>);</span><br><span class="line">    $key = md5($salt);</span><br><span class="line">&#125;</span><br><span class="line">$chars = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_."</span>;</span><br><span class="line">$ikey = <span class="string">"-x6g6ZWm2G9g_vr0Bo.pOq3kRIxsZ6rm"</span>;</span><br><span class="line">$knum = <span class="number">0</span>;</span><br><span class="line">$i = <span class="number">0</span>;</span><br><span class="line">$tlen = @strlen($txt);</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">isset</span>($key&#123;$i&#125;)) &#123;</span><br><span class="line">    $knum += ord($key&#123;$i++&#125;); <span class="comment">//$knum 姑且称作密钥数字是固定的,根据$key来决定,$key又是字符串中的MD5盐值,所以,通过这个密钥来打开密文.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ch1 = @$txt&#123;$knum % $tlen&#125;;<span class="comment">//对用93行,利用密钥数字来得到第一个随机字符$ch1,前面加密函数的随机数就是通过这种方式,通过已知密钥获得未知的随机字符ch1</span></span><br><span class="line">$nh1 = strpos($chars, $ch1);<span class="comment">//因为nh1是ch1在字符集中的下标数字,那么这里通过查找字符集中字符所在下标,得到随机数字nh1</span></span><br><span class="line">$txt = @substr_replace($txt, <span class="string">''</span>, $knum % $tlen--, <span class="number">1</span>);<span class="comment">//当获取到ch1了,就把这个ch1去掉,下面会逐步去掉ch2,和ch3,还原成原本的密文.</span></span><br><span class="line">$ch2 = @$txt&#123;$nh1 % $tlen&#125;;</span><br><span class="line">$nh2 = @strpos($chars, $ch2);</span><br><span class="line">$txt = @substr_replace($txt, <span class="string">''</span>, $nh1 % $tlen--, <span class="number">1</span>);</span><br><span class="line">$ch3 = @$txt&#123;$nh2 % $tlen&#125;;</span><br><span class="line">$nh3 = @strpos($chars, $ch3);</span><br><span class="line">$txt = @substr_replace($txt, <span class="string">''</span>, $nh2 % $tlen--, <span class="number">1</span>);<span class="comment">//最后将密文txt去掉埋点,还原成原始密文</span></span><br><span class="line">$nhnum = $nh1 + $nh2 + $nh3;<span class="comment">//获得nhnum</span></span><br><span class="line">$mdKey = substr(md5(md5(md5($key . $ch1) . $ch2 . $ikey) . $ch3), $nhnum % <span class="number">8</span>, $knum % <span class="number">8</span> + <span class="number">16</span>);</span><br><span class="line"><span class="comment">//这里就很简单了,前面几个的随机数都已经获取到了 生成mdKey</span></span><br><span class="line">$tmp = <span class="string">''</span>;</span><br><span class="line">$j = <span class="number">0</span>;</span><br><span class="line">$k = <span class="number">0</span>;</span><br><span class="line">$tlen = @strlen($txt);</span><br><span class="line">$klen = @strlen($mdKey);</span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $tlen; $i++) &#123;<span class="comment">//这里对应84行,</span></span><br><span class="line">    $k = $k == $klen ? <span class="number">0</span> : $k;</span><br><span class="line">    $j = strpos($chars, $txt&#123;$i&#125;) - $nhnum - ord($mdKey&#123;$k++&#125;);</span><br><span class="line">    <span class="keyword">while</span> ($j &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        $j += <span class="number">64</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $tmp .= $chars&#123;$j&#125;;<span class="comment">//这一步将密文还原成 base64编码后的形式 这里base64_encode(time() . '_' . $txt);</span></span><br><span class="line">&#125;</span><br><span class="line">$tmp = str_replace(<span class="keyword">array</span>(<span class="string">'-'</span>, <span class="string">'_'</span>, <span class="string">'.'</span>), <span class="keyword">array</span>(<span class="string">'+'</span>, <span class="string">'/'</span>, <span class="string">'='</span>), $tmp);<span class="comment">//对应78行</span></span><br><span class="line">$tmp = trim(base64_decode($tmp));</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/\d&#123;10&#125;_/s"</span>, substr($tmp, <span class="number">0</span>, <span class="number">11</span>))) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($ttl &gt; <span class="number">0</span> &amp;&amp; (time() - substr($tmp, <span class="number">0</span>, <span class="number">11</span>) &gt; $ttl)) &#123;<span class="comment">//ttl应该是过期时间,判断这个密文是否过期.过期返回null</span></span><br><span class="line">        $tmp = <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $tmp = substr($tmp, <span class="number">11</span>); <span class="comment">//对应77行,时间戳长度为10,前面明文是拼接了 time() +'_'的,这里判断没有过期(默认不设置时效性,TLL=0),则返回时间戳之后的明文.也就是第11位之后的字符串.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $tmp;</span><br></pre></td></tr></table></figure>

<p>下面一段比较复杂的逆向注释:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $tlen; $i++) &#123; <span class="comment">//根据 遍历$txt 拼接新的 $tmp</span></span><br><span class="line">    $k = $k == $klen ? <span class="number">0</span> : $k; <span class="comment">//$k=0  k表示mdKey中的指针,这里表示指针循环.</span></span><br><span class="line">    $j = ($nhnum + strpos($chars, $txt&#123;$i&#125;) + ord($mdKey&#123;$k++&#125;)) % <span class="number">64</span>;</span><br><span class="line">    <span class="comment">//(随机数字之和 + 当前txt指针的字符位于字符集中的位置数字 + 当前mdKey指针位置字符的ascii码值) % 64</span></span><br><span class="line">    $tmp .= $chars&#123;$j&#125;;<span class="comment">//再讲上面的获得的指针找到字符集中指定位置的值,拼接给$tmp</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $tlen; $i++) &#123;<span class="comment">//这里对应84行,</span></span><br><span class="line">    $k = $k == $klen ? <span class="number">0</span> : $k;</span><br><span class="line">    $j = strpos($chars, $txt&#123;$i&#125;) - $nhnum - ord($mdKey&#123;$k++&#125;);</span><br><span class="line">    <span class="keyword">while</span> ($j &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        $j += <span class="number">64</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $tmp .= $chars&#123;$j&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 加密函数来看,明文是通过strpos($chars,$txt&#123;$i&#125;) 这样的方式来生成新下标$j,获得密文字符的.</span></span><br><span class="line"><span class="comment"> * 那么解密当时是需要得到strpos($chars,$txt&#123;$i&#125;) 的值,利用这个值反推 $txt&#123;$i&#125; 得到明文.</span></span><br><span class="line"><span class="comment"> * strpos($chars,明文字符) = $j- $nhnum - ord($mdKey&#123;$k++&#125;)</span></span><br><span class="line"><span class="comment"> * 而$j 是密文在chars中的下标,要得到$j ,则取得当前密文字符在chars的下标即可.strpos($chars, $txt&#123;$i&#125;)</span></span><br><span class="line"><span class="comment"> * 最后得到 strpos($chars,明文字符) = strpos($chars, 密文字符) - $nhnum - ord($mdKey&#123;$k++&#125;)</span></span><br><span class="line"><span class="comment"> * */</span></span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="# 总结"></a># 总结</h4><p>​        <strong>看完这对加解密函数,可以发现解密的时候是通过密钥,将藏在密文中的3个随机字符找到,然后通过这种方式来获得加密时的3个随机数.再进行逆运算即可解密.</strong></p>
<h3 id="0x04-漏洞成因-任意用户登录"><a href="#0x04-漏洞成因-任意用户登录" class="headerlink" title="# 0x04 漏洞成因 - 任意用户登录"></a># 0x04 漏洞成因 - 任意用户登录</h3><p>​        有问题的地方出现在<strong>systemLogin()函数</strong>,在HomeBase的<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707212306265.png" alt="image-20200707212306265"></p>
<p>​        初始化函数中,在访问继承了HomeBase的控制器都会执行此初始化函数判断当前是否有用户登录.        </p>
<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707212403796.png" alt="image-20200707212403796"></p>
<p>​        当访问页面时,判断当前session是否有userid字段和username字段,<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707212505407.png" alt="image-20200707212505407"></p>
<p>​        <u>回顾登录成功后的操作是有对这2个SESSION进行赋值的,所以此处47行的判断是如果是刚login进来的,那么session必定会有这2个值,且其他的session字段也都已经赋值完毕…如果只有其中一个值或者没有值,说明此session还没有执行登录操作,根据cookie实现自动登录的原理,尝试去cookie中,读取我们的用户信息,<strong>如果成功读取到</strong>,将信息存到session中去.</u></p>
<h4 id="校验逻辑"><a href="#校验逻辑" class="headerlink" title="# 校验逻辑"></a># 校验逻辑</h4><p>​        <strong>问题在于上面的逻辑中,是如何判断此cookie是合法用户,可以被成功读取到?</strong></p>
<p>​        继续跟进,51行,将 cookie值: <strong>cookpre[5]sys_key</strong> 密文进行解密,并且反序列化获得user数组给$user,<strong>关键位置在55行,如果这个返回的数组$user,同时存在$user[‘id’] 和 $user[‘username’] 则判断其登录成功,并且对session进行数组的其他值的赋值.</strong></p>
<p>​        也就是说,只要我<strong>能伪造成功$user[‘id’] 和 $user[‘username’],我的cookie里面的数组包含这2个字段的值,整个数组都会被赋值到当前session中,如果后面的业务功能直接去到session去取值识别身份,就能过伪造用户成功.</strong> </p>
<h3 id="0x05-复现"><a href="#0x05-复现" class="headerlink" title="# 0x05 复现"></a># 0x05 复现</h3><p>​        通过上面分析,我们找到个人中心页面进行复现,可以看到index方法在25行是 <strong>通过session中的userid</strong> ,去数据库中查找 对应 id的 行,获取到当前的用户信息,<strong>也就是说这个页面, session[‘userid’] 就代表了用户身份,通过此id获取用户信息.</strong><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707225744001.png" alt="image-20200707225744001"></p>
<p>整个漏洞利用逻辑如下:</p>
<p><strong>在当前session没有登录信息的状态下(session中没有userid和username) –&gt; 构造一个数组,传入想伪造用户的userid  –&gt; 用加密函数和密钥进行加密得到伪造的cookie –&gt; 访问个人中心页面并且传入我们伪造的cookie –&gt; 程序对cookie进行解密和反序列化拿到$user数组并且对session[‘userid’]进行赋值 –&gt; 然后执行/user/index/index方法,从数据库中取出当前session[‘userid’] 的行的信息,然后给页面变量赋值 –&gt; 显示当前userid用户的信息. 伪造用户成功.</strong>  </p>
<p>后续也能看到/User/Index控制器下的很多方法都是通过session[‘userid’]去数据库来获取身份信息,都能够伪造成功.</p>
<h4 id="复现"><a href="#复现" class="headerlink" title="# 复现"></a># 复现</h4><p>​        现在关键点在于需要能够伪造到我们的cookie,上文对加解密函数均已分析过,只要把加密函数拿出来,拿到我们的密钥,即可对cookie进行伪造.</p>
<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707233750883.png" alt="image-20200707233750883"></p>
<p>这里我们伪造 id=1 的用户,先运行这个脚本获取cookie.</p>
<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707233846387.png" alt="image-20200707233846387"></p>
<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707233918252.png" alt="image-20200707233918252"></p>
<p>直接点击登录抓包传入cookie.<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707234008446.png" alt="image-20200707234008446"></p>
<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707234048145.png" alt="image-20200707234048145"></p>
<p>可以看到直接登录进去了,并且显示我有100金币(因为我point写的是100,但是应该是假的,因为数据库不会更新这个point字段)进入个人中心看看.</p>
<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707234244978.png" alt="image-20200707234244978"></p>
<p>看到用户名是plini , 跟我伪造的 zengjiajun 不同,是因为我传入的id是1,id=1对应数据库中的用户,用户名为plini,所以是根据userid来判断身份. 所以只要随意修改id值,伪造再传入就可以模仿任意用户登录了.</p>
<h3 id="0x06-总结"><a href="#0x06-总结" class="headerlink" title="# 0x06 总结"></a># 0x06 总结</h3><p>​        漏洞分析告一段落了,分析下漏洞形成的原因主要有2点:</p>
<h4 id="1-用户登录逻辑缺陷"><a href="#1-用户登录逻辑缺陷" class="headerlink" title="1.用户登录逻辑缺陷"></a>1.用户登录逻辑缺陷</h4><p>​        系统对于用户登录状态的判断有缺陷,只判断 cookie 解密出来数组中的 (userid 和 username) 存在,就判断为登录成功,将数组的值赋值到session,导致只要能够伪造cookie数组的这2个字段值,就可以实现成功登录.<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707234626308.png" alt="image-20200707234626308"></p>
<h4 id="2-密钥获取"><a href="#2-密钥获取" class="headerlink" title="2.密钥获取"></a>2.密钥获取</h4><p>​        而要伪造cookie数组,关键一步是加密的过程,cookie加密用到的密钥是 admin_user 表中,id=1那一行的salt字段值,这个值是在程序安装的时候写入的,</p>
<p><img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707235428171.png" alt="image-20200707235428171"></p>
<p>硬编码 + 5位随机字母  , 然而这5位随机字母就是Cookie的前缀以及Session的前缀,想要获得可以爆破,也可以通过先注册一个用户,然后查看自身cookie前缀即可获得. 以至于密钥我们也能够轻易拿到,能够对cookie进行加密了.</p>
<p>最后加密过程为:<img src="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/image-20200707235503224.png" alt="image-20200707235503224"></p>
<p>修改任意ID即可.</p>
<h4 id="修复想法"><a href="#修复想法" class="headerlink" title="# 修复想法"></a># 修复想法</h4><p>​        盐值用了硬编码写死在里面,而后面的随机字母又当做前缀出现在Cookie中,导致密钥被获取这是最大的问题,只要盐值完全随机,即可避免问题.</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Dj3ntG0d</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://dj3ntg0d.github.io/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/">https://dj3ntg0d.github.io/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95-%E7%99%BB%E5%BD%95%E5%92%8C%E6%BC%8F%E6%B4%9E%E7%AF%87/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/07/09/Laysns%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8B%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><img class="prev_cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Laysns反序列化之任意文件删除漏洞分析</div></div></a></div><div class="next-post pull_right"><a href="/2020/07/05/Laysns%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90%E5%8F%8A%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95--%E6%B3%A8%E5%86%8C%E7%AF%87/"><img class="next_cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Laysns注册登录逻辑分析及任意用户登录--注册篇</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Dj3ntG0d</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script></body></html>